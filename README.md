
# TCP task

Проект реализует TCP-сервер и двух TCP-клиентов, которые обмениваются ASCII-сообщениями с переносом строки (`0x0A`). Сервер отвечает на пинги клиентов и периодически отправляет keepalive-сообщения. Все действия логируются в CSV-файлы.

## Особенности

- Сервер слушает TCP-порт.
- Клиенты подключаются к серверу и отправляют сообщения формата:

```
\[<номер\_запроса>] PING
```

- Сервер с вероятностью 10% игнорирует запрос. В остальных случаях отвечает через случайную задержку 100–1000 мс:

```
\[<номер\_ответа>/<номер\_запроса>] PONG (<номер\_клиента>)
```

- Раз в 5 секунд сервер отправляет всем клиентам keepalive:

```
\[<номер\_ответа>] keepalive
```

- Сквозная нумерация ответов сервера ведётся независимо от клиента и типа сообщения.
- Сервер и клиенты ведут отдельные CSV-логи.
- Все процессы работают 5 минут и затем корректно завершаются.

## Запуск

---

### 1. Сборка образа

```bash
docker-compose build
```

---

### 2. Запуск всех сервисов

```bash
docker-compose up
```

* Сервер слушает TCP порт `65432`.
* Клиенты автоматически подключаются к серверу.
* Все три процесса работают параллельно.
* Через 5 минут клиенты завершатся автоматически.

---

### 3. Просмотр логов

* Сервер: `server_log.csv`
* Клиент 1: `client1_log.csv`
* Клиент 2: `client2_log.csv`

Файлы создаются в текущей директории в logs/.

---

### 4. Остановка контейнеров вручную

```bash
docker-compose down
```

---

## Формат логов

### Сервер (`server_log.csv`)

| Дата        | Время запроса  | Текст запроса | Время ответа   | Текст ответа    |
|-------------|----------------| ------------- | -------------- | --------------- |
| ГГГГ-ММ-ДД  | ЧЧ\:ММ\:СС.ССС | \[0] PING     | ЧЧ\:ММ\:СС.ССС | \[0/0] PONG (1) |
| ...         | ...            | ...           | ...            | ...             |

> Для проигнорированных сообщений `Время ответа` и `Текст ответа` = `(проигнорировано)`.

### Клиенты (`clientX_log.csv`)

| Дата       | Время запроса  | Текст запроса | Время ответа/таймаут | Текст ответа/таймаут |
| ---------- | -------------- | ------------- | -------------------- | -------------------- |
| ГГГГ-ММ-ДД | ЧЧ\:ММ\:СС.ССС | \[0] PING     | ЧЧ\:ММ\:СС.ССС       | \[0/0] PONG (1)      |
| ГГГГ-ММ-ДД |                |               | ЧЧ\:ММ\:СС.ССС       | keepalive            |
| ГГГГ-ММ-ДД | ЧЧ\:ММ\:СС.ССС | \[1] PING     | ЧЧ\:ММ\:СС.ССС       | (таймаут)            |

> Для keepalive поля запроса пустые. Таймаут фиксируется, если сервер проигнорировал PING.

---

## Примечания

* Все сообщения должны быть ASCII с символом `\n` на конце.
* Сервер и клиенты используют asyncio для асинхронной работы.
* Таймер на 5 минут обеспечивает корректное завершение соединений и запись логов.

---